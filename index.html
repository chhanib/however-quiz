<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>'However' Usage Quiz</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        /* ... (styles remain the same) ... */
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1>'However' Usage Quiz</h1>
        <div id="progress-bar">
            <div id="progress"></div>
        </div>
        <div id="question-container"></div>
        <div class="navigation">
            <button id="prev-button" onclick="showPreviousQuestion()" style="display:none;">Previous</button>
            <button id="next-button" onclick="showNextQuestion()">Next</button>
        </div>
        <div id="result"></div>
        <div id="statistics"></div>
        <button id="clear-data" onclick="clearAllData()" style="display:none;">Clear All Data</button>
    </div>

    <script>
        // Initialize Firebase (replace with your own config)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const questions = [
            // ... (questions remain the same) ...
        ];

        let currentQuestion = 0;
        const responses = new Array(questions.length).fill(null);
        let charts = [];

        function showQuestion(index) {
            // ... (function remains the same) ...
        }

        function selectOption(option, index) {
            // ... (function remains the same) ...
        }

        function showNextQuestion() {
            // ... (function remains the same) ...
        }

        function showPreviousQuestion() {
            // ... (function remains the same) ...
        }

        function submitQuiz() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<h2>Thank you for completing the quiz!</h2>`;
            saveResponses(responses);
            showStatistics();
            document.getElementById('clear-data').style.display = 'block';
        }

        function saveResponses(responses) {
            database.ref('responses').push(responses);
        }

        function showStatistics() {
            database.ref('responses').once('value', (snapshot) => {
                const allResponses = snapshot.val() ? Object.values(snapshot.val()) : [];
                const totalResponses = allResponses.length;
                const stats = questions.map(() => ({correct: 0, incorrect: 0}));

                allResponses.forEach(response => {
                    response.forEach((answer, index) => {
                        if (answer === 'correct') stats[index].correct++;
                        if (answer === 'incorrect') stats[index].incorrect++;
                    });
                });

                let statsHtml = `<h2>Overall Statistics (${totalResponses} responses)</h2>`;
                stats.forEach((stat, index) => {
                    const total = stat.correct + stat.incorrect;
                    statsHtml += `
                        <div class="question-stat">
                            <h3>Question ${index + 1}:</h3>
                            <p>${questions[index]}</p>
                            <p>Correct: ${stat.correct} (${((stat.correct / total) * 100).toFixed(2)}%)</p>
                            <p>Incorrect: ${stat.incorrect} (${((stat.incorrect / total) * 100).toFixed(2)}%)</p>
                            <div class="chart-container">
                                <canvas id="chart-${index}"></canvas>
                            </div>
                        </div>
                    `;
                });

                document.getElementById('statistics').innerHTML = statsHtml;
                
                // Create charts for each question
                stats.forEach((stat, index) => {
                    createChart(stat, index);
                });
            });
        }

        function createChart(stat, index) {
            // ... (function remains the same) ...
        }

        function updateProgressBar() {
            // ... (function remains the same) ...
        }

        function clearAllData() {
            if (confirm("Are you sure you want to clear all stored quiz data? This action cannot be undone.")) {
                database.ref('responses').remove()
                    .then(() => {
                        document.getElementById('statistics').innerHTML = '';
                        document.getElementById('result').innerHTML = '<h2>All data has been cleared.</h2>';
                        document.getElementById('clear-data').style.display = 'none';
                        charts.forEach(chart => {
                            if (chart) chart.destroy();
                        });
                        charts = [];
                    })
                    .catch((error) => {
                        console.error("Error clearing data: ", error);
                    });
            }
        }

        // Initialize the quiz
        showQuestion(currentQuestion);
    </script>
</body>
</html>
